# Checkpoint: Fix Crítico de "Hang" en QR y Estabilidad
**Fecha:** 2026-02-27  
**Agente:** CRONISTA-Estados-Notas  
**ID:** FIX-20260227-HANG

## Tarea(s) Abordada(s)
- **FIX-20260227-HANG**: Resolución del bloqueo (hang) al escanear QR y caídas aleatorias de conexión.

## Cambios Realizados
1.  **Downgrade de Baileys**:
    -   Se revertió de `v6.7.x` a **`v6.6.0`** (versión conocida por su estabilidad en entornos Node.js restringidos).
    -   Razón: La versión más reciente presentaba incompatibilidades con la gestión de sockets en el entorno de extensión de VS Code, causando "hangs" silenciosos.

2.  **Implementación de Store Manual**:
    -   Se reemplazó la gestión de estado en memoria por defecto de Baileys con un `makeInMemoryStore` explícito.
    -   Se añadió lógica de "bind" al socket para asegurar que los eventos actualicen el store correctamente.

3.  **Comando de Emergencia "Reiniciar Sesión"**:
    -   Se implementó `whatsapp.reset` (Factory Reset).
    -   Permite al usuario borrar completamente la carpeta de autenticación y reiniciar el proceso de vinculación sin tener que borrar archivos manualmente del sistema de archivos.

## Contexto de Negocio
El plugin era inutilizable para nuevos usuarios debido a que el escaneo del QR no completaba la conexión (se quedaba "colgado"). Este fix es bloqueante para la adopción.

## Soft Gates
-   [x] **Compilación**: `npm run compile` exitoso.
-   [x] **Testing**: Probado manualmente (QR escanea y conecta sin hang).
-   [x] **Revisión**: Código simplificado para evitar race conditions.
-   [x] **Documentación**: Actualizado en este Checkpoint y `PROYECTO.md`.

## Próximos Pasos
-   Monitorear estabilidad de la versión 6.6.0.
-   Considerar migración a `useMultiFileAuthState` con mejor manejo de errores si persisten problemas de disco.
